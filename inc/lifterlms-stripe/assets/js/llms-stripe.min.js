(function($){var llms_stripe=window.llms_stripe||{};Stripe.setPublishableKey(llms_stripe.publishable_key);llms_stripe.bind=function(){var self=this,allowed=["0","1","2","3","4","5","6","7","8","9"," "];window.llms.checkout.add_before_submit_event({data:self,handler:self.submit});$("#llms_stripe_cc_number, #llms_stripe_expiration, #llms_stripe_expiration").on("keypress",function(e){if(-1===allowed.indexOf(String.fromCharCode(e.which||e.keyCode))){return false}});$("#llms_stripe_expiration").on("keydown",function(e){var $el=$(this),val=$el.val();if(5===val.length&&8===e.keyCode){$el.val(val.substr(0,2))}});$("#llms_stripe_expiration").on("keypress",function(e){var $el=$(this),val=$el.val(),char=String.fromCharCode(e.which||e.keyCode);if(1===val.length&&-1!==allowed.indexOf(char)){$el.val(val+char+" / ");return false}});$("#llms_stripe_cc_number").on("focusout keyup",function(){$(this).closest(".llms-form-field").attr("data-brand",Stripe.card.cardType($(this).val()));self.validate($(this),"validateCardNumber")});$("#llms_stripe_expiration").on("focusout keyup",function(e){self.validate($(this),"validateExpiry")});$("#llms_stripe_cvc").on("focusout keyup",function(){self.validate($(this),"validateCVC")});$("#llms_stripe_saved_card_id").on("change",function(){var card_id=$(this).val(),$card_id=$("#llms_stripe_card_id"),$form=$(".llms-stripe-cc-form"),$fields=$form.find("input");if("create-new"===card_id){$card_id.val("");$form.slideDown(200);$fields.removeAttr("disabled")}else{$card_id.val(card_id);$fields.attr("disabled","disabled");$form.slideUp(200)}});$("#llms_stripe_saved_card_id").trigger("change");$(".llms-payment-gateways").on("llms-gateway-selected",function(e,data){if("stripe"===data.id){$("#llms_stripe_saved_card_id").trigger("change")}});$("#llms-stripe-autofill-cc").on("click",function(){$("#llms_stripe_saved_card_id").val("create-new").trigger("change");var date=new Date;$("#llms_stripe_cc_number").val($("#llms-stripe-autofill-cc-card-number").val()).trigger("keyup");$("#llms_stripe_expiration").val("12 / "+(date.getFullYear()+1)).trigger("keyup");$("#llms_stripe_cvc").val("123").trigger("keyup")})};llms_stripe.get_error=function(code,fallback){var msg=LLMS.l10n.strings["stripe-"+code]?LLMS.l10n.translate("stripe-"+code):fallback;if(!msg){LLMS.l10n.translate("stripe-unknown")}return msg};llms_stripe.get_token=function(callback){var token=$("#llms_stripe_token").val()||"",card={cvc:$("#llms_stripe_cvc").val(),exp:$("#llms_stripe_expiration").val(),number:$("#llms_stripe_cc_number").val(),name:($("#first_name").val()+" "+$("#last_name").val()).trim()||"",address_line1:$("#llms_billing_address_1").val()||"",address_line2:$("#llms_billing_address_2").val()||"",address_city:$("#llms_billing_city").val()||"",address_state:$("#llms_billing_state").val()||"",address_zip:$("#llms_billing_zip").val()||"",address_country:$("#llms_billing_country").val()||""};Stripe.card.createToken(card,function(status,r){if(r.error){return callback(false,r.error)}else if(r.id){return callback(r)}})};llms_stripe.is_selected=function(){return $("#llms_payment_gateway_stripe").is(":checked")};llms_stripe.submit=function(self,callback){var $saved=$("#llms_stripe_saved_card_id"),$form=$(this),response=true;if(!self.is_selected()){callback(response);return}if($saved.length&&"create-new"!==$saved.val()){callback(response);return}llms_stripe.get_token(function(token,err){if(!token){if(err&&err.code){response=self.get_error(err.code,err.message)}else{response=self.get_error(err.code,err.message)}}else if(token&&token.id&&token.card&&token.card.id){$("#llms_stripe_token").val(token.id);$("#llms_stripe_card_id").val(token.card.id)}else{response=self.get_error(err.code,err.message)}callback(response)})};llms_stripe.validate=function($el,validation_function){var $parent=$el.closest(".llms-form-field"),$fields=$parent.closest(".llms-gateway-fields"),$submit=$("#llms_create_pending_order"),val=$el.val(),valid=Stripe.card[validation_function](val),add_class,remove_class;if(!val.length){add_class="";remove_class="valid invalid"}else if(valid){add_class="valid";remove_class="invalid"}else{add_class="invalid";remove_class="valid"}$parent.removeClass(remove_class).addClass(add_class);if($fields.find(".invalid").length){$submit.attr("disabled","disabled")}else{$submit.removeAttr("disabled")}};window.llms.checkout.add_gateway(llms_stripe);llms_stripe.bind()})(jQuery);